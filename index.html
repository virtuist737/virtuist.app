<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#009BFF">
    <meta name="description" content="Practice and study virtues to bring more peace and joy to your life">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Virtuist">
    <title>Virtuist</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="icon" href="assets/favicon.ico">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
</head>
<body>
    <div class="header">
        <div class="logo-container" style="cursor: pointer;" onclick="showVirtues()">
            <img src="assets/apple-touch-icon.png" width="75" height="75" alt="Virtuist logo">
            <h1 class="app-title">Virtuist</h1>
        </div>
        <button id="infoButton" class="info-button">i</button>
    </div>

    <div class="mode-selector" style="display: none;">
        <button class="mode-button active" onclick="switchMode('practice')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="6"/>
                <circle cx="12" cy="12" r="2"/>
            </svg>
            Practice
        </button>
        <button class="mode-button" onclick="switchMode('study')">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 122.88 101.37" style="enable-background:new 0 0 122.88 101.37" xml:space="preserve">
                <g>
                    <path fill="#FFFFFF" d="M12.64,77.27l0.31-54.92h-6.2v69.88c8.52-2.2,17.07-3.6,25.68-3.66c7.95-0.05,15.9,1.06,23.87,3.76 c-4.95-4.01-10.47-6.96-16.36-8.88c-7.42-2.42-15.44-3.22-23.66-2.52c-1.86,0.15-3.48-1.23-3.64-3.08 C12.62,77.65,12.62,77.46,12.64,77.27L12.64,77.27z M103.62,19.48c-0.02-0.16-0.04-0.33-0.04-0.51c0-0.17,0.01-0.34,0.04-0.51V7.34 c-7.8-0.74-15.84,0.12-22.86,2.78c-6.56,2.49-12.22,6.58-15.9,12.44V85.9c5.72-3.82,11.57-6.96,17.58-9.1 c6.85-2.44,13.89-3.6,21.18-3.02V19.48L103.62,19.48z M110.37,15.6h9.14c1.86,0,3.37,1.51,3.37,3.37v77.66 c0,1.86-1.51,3.37-3.37,3.37c-0.38,0-0.75-0.06-1.09-0.18c-9.4-2.69-18.74-4.48-27.99-4.54c-9.02-0.06-18.03,1.53-27.08,5.52 c-0.56,0.37-1.23,0.57-1.92,0.56c-0.68,0.01-1.35-0.19-1.92-0.56c-9.04-4-18.06-5.58-27.08-5.52c-9.25,0.06-18.58,1.85-27.99,4.54 c-0.34,0.12-0.71,0.18-1.09,0.18C1.51,100.01,0,98.5,0,96.64V18.97c0-1.86,1.51-3.37,3.37-3.37h9.61l0.06-11.26 c0.01-1.62,1.15-2.96,2.68-3.28l0,0c8.87-1.85,19.65-1.39,29.1,2.23c6.53,2.5,12.46,6.49,16.79,12.25 c4.37-5.37,10.21-9.23,16.78-11.72c8.98-3.41,19.34-4.23,29.09-2.8c1.68,0.24,2.88,1.69,2.88,3.33h0V15.6L110.37,15.6z M68.13,91.82c7.45-2.34,14.89-3.3,22.33-3.26c8.61,0.05,17.16,1.46,25.68,3.66V22.35h-5.77v55.22c0,1.86-1.51,3.37-3.37,3.37 c-0.27,0-0.53-0.03-0.78-0.09c-7.38-1.16-14.53-0.2-21.51,2.29C79.09,85.15,73.57,88.15,68.13,91.82L68.13,91.82z M58.12,85.25 V22.46c-3.53-6.23-9.24-10.4-15.69-12.87c-7.31-2.8-15.52-3.43-22.68-2.41l-0.38,66.81c7.81-0.28,15.45,0.71,22.64,3.06 C47.73,78.91,53.15,81.64,58.12,85.25L58.12,85.25z"/>
                </g>
            </svg>
            Study
        </button>
    </div>

    <div id="selectedVirtueContainer" class="selected-virtue-container">
        <button class="back-arrow" onclick="showVirtues()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
        </button>
        <div id="selectedVirtue" class="selected-virtue"></div>
    </div>
    
    <div class="virtue-grid" id="virtueGrid"></div>

    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>What are virtues?</h2>
            </br>
            <p>Virtues are universal behavioral instruments that elicit lasting peace and joy.</p>
            </br>
            <p>Just as musical instruments---like the piano---can elicit emotional experiences, virtues---like gratitude or empathy---are behavioral instruments that when wielded skillfully can elicit lasting emotional experiences of peace and/or joy in oneself and others.</p>
            </br>
            <h2>Why does this app exist?</h2>
            </br>
            <p>I'm building Virtuist in hopes that it will enable and inspire more individuals and families to practice virtues, thereby reducing suffering and increasing peace and joy.</p>
            </br>
            <p>I have observed that while both religious and secular organizations succeed at helping people practice some virtues, they fail to help with other virtues.</p>
            </br>
            <p>This app is my attempt to pave a better path that we can all walk together, helping each other practice virtues that will bring us all greater peace and joy.</p>
            </br>
            <h2>What are the plans for this app?</h2>
            </br>
            <p>My vision is to build an app similar to Duolingo, but instead of helping people study and practice their choice of foreign languages it will help them study and practice virtues.</p>
            </br>
            <p>I plan to first focus on the app itself, building it into a gamified experience with a robust library of resources.</p>
            </br>
            <p>Then I plan to try to enable Virtuists to connect with each other and build local communities on a common foundation of virtues.</p>
            </br>
            <h2>How can you help?</h2>
            </br>
            <ol>
                <li>Share Virtuist with your family and friends, inviting them to practice and study virtues with you.</li>
                <li>Email me at hello@virtuist.app to share your ideas for app features, practice exercises and example stories.</li>
                <li>Donate below so I can invest more time and money into building Virtuist. Every dollar helps and is greatly appreciated.</li>
            </ol>
            </br>
            <p>Thank you!</p>
            <div class="donation-container">
                <script async src="https://js.stripe.com/v3/buy-button.js"></script>
                <stripe-buy-button
                    buy-button-id="buy_btn_1QjWZdRw86YJu12Yh43fRmbu"
                    publishable-key="pk_live_51QjWB9Rw86YJu12YJnjfIDDhEkzmg8FCwnq0MI6kbC5fEviXQOVQlvGkgnqvpRV7mbhe8AzBwiFrAJdD2zVlKX4c002xSS1Wu8"
                >
                </stripe-buy-button>
            </div>
        </div>
    </div>

    <div class="content-container" id="practiceContainer">
        <div class="section">
            <div class="section-header">
                <div class="nav-arrows">
                    <button class="nav-arrow" onclick="previousPractice()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                    </button>
                    <button class="nav-arrow" onclick="nextPractice()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </button>
                </div>
                <h3>Exercise</h3>
            </div>
            <div class="section-content" id="practiceText"></div>
        </div>
    </div>

    <div class="content-container" id="studyContainer">
        <div class="section">
            <div class="section-header">
                <h3>Definition</h3>
            </div>
            <div class="section-content" id="studyDefinition"></div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <div class="nav-arrows">
                    <button class="nav-arrow" onclick="previousStory()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                    </button>
                    <button class="nav-arrow" onclick="nextStory()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </button>
                </div>
                <h3>Example Story</h3>
            </div>
            <div class="section-content" id="studyStory"></div>
        </div>
    </div>

    <script>
        // Initialize variables
        let db;
        let virtues = [];
        let virtueColors = {};
        let virtuePractices = {};
        let virtueStories = {};
        let virtueDefinitions = {};
        let currentMode = 'practice';
        let currentVirtue = null;
        let currentPracticeIndex = 0;
        let currentStoryIndex = 0;

        // Initialize database and load data
        async function initDB() {
            try {
                const sqlPromise = initSqlJs({
                    locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
                });
                const dataPromise = fetch('virtuist.db').then(res => res.arrayBuffer());
                const [SQL, buf] = await Promise.all([sqlPromise, dataPromise]);
                return new SQL.Database(new Uint8Array(buf));
            } catch (error) {
                console.error('Error initializing database:', error);
                throw error;
            }
        }

        async function loadVirtuesData() {
            try {
                db = await initDB();
                
                // Load virtues and their properties
                const virtuesResult = db.exec(`
                    SELECT name, color, definition 
                    FROM virtues 
                    ORDER BY id
                `);
                
                if (virtuesResult[0] && virtuesResult[0].values) {
                    virtues = virtuesResult[0].values.map(row => row[0]);
                    virtueColors = Object.fromEntries(
                        virtuesResult[0].values.map(row => [row[0], row[1]])
                    );
                    virtueDefinitions = Object.fromEntries(
                        virtuesResult[0].values.map(row => [row[0], row[2]])
                    );
                }

                // Initialize the app
                initializeApp();
            } catch (error) {
                console.error('Error loading virtues data:', error);
            }
        }

        async function loadStoriesForVirtue(virtue) {
            try {
                const result = db.exec(`
                    SELECT content 
                    FROM stories 
                    WHERE virtue_id = (SELECT id FROM virtues WHERE name = '${virtue}')
                    ORDER BY id
                `);
                return result[0]?.values.map(row => row[0]) || [];
            } catch (error) {
                console.error('Error loading stories:', error);
                return [];
            }
        }

        async function loadPracticesForVirtue(virtue) {
            try {
                const result = db.exec(`
                    SELECT content 
                    FROM practices 
                    WHERE virtue_id = (SELECT id FROM virtues WHERE name = '${virtue}')
                    ORDER BY id
                `);
                return result[0]?.values.map(row => row[0]) || [];
            } catch (error) {
                console.error('Error loading practices:', error);
                return [];
            }
        }

        // Animation helper function
        function animateContentTransition(element, direction, isNext) {
            const currentContent = element.innerHTML;
            const outClass = isNext ? 'next-out' : 'prev-out';
            const inClass = isNext ? 'next-in' : 'prev-in';
            
            element.classList.add(outClass);
            
            setTimeout(() => {
                element.classList.remove(outClass);
                element.innerHTML = direction;
                element.classList.add(inClass);
                
                setTimeout(() => {
                    element.classList.remove(inClass);
                }, 300);
            }, 300);
        }

        function initializeApp() {
            const virtueGrid = document.getElementById('virtueGrid');
            virtues.forEach((virtue, index) => {
                const button = document.createElement('button');
                button.className = 'virtue-button';
                button.style.backgroundColor = virtueColors[virtue];
                button.onclick = () => selectVirtue(virtue);
                button.textContent = virtue.charAt(0).toUpperCase() + virtue.slice(1);
                button.style.animationDelay = `${index * 0.1}s`;
                virtueGrid.appendChild(button);
            });
        }

        async function selectVirtue(virtue) {
            currentVirtue = virtue;
            currentPracticeIndex = 0;
            currentStoryIndex = 0;
            
            // Animate the grid away
            const virtueGrid = document.getElementById('virtueGrid');
            virtueGrid.classList.add('animate-out');
            
            setTimeout(async () => {
                // Load data
                virtueStories[virtue] = await loadStoriesForVirtue(virtue);
                virtuePractices[virtue] = await loadPracticesForVirtue(virtue);
                
                // Update styles and show new content
                document.documentElement.style.setProperty('--primary-color', virtueColors[virtue]);
                
                const selectedVirtueElement = document.getElementById('selectedVirtue');
                selectedVirtueElement.textContent = virtue.charAt(0).toUpperCase() + virtue.slice(1);
                
                // Show containers with animations
                document.getElementById('selectedVirtueContainer').style.display = 'block';
                document.querySelector('.mode-selector').style.display = 'flex';
                
                // Update colors
                document.querySelector('.mode-button.active').style.backgroundColor = 'var(--primary-color)';
                document.getElementById('infoButton').style.backgroundColor = 'var(--primary-color)';
                
                virtueGrid.style.display = 'none';
                virtueGrid.classList.remove('animate-out');
                
                showContent();
            }, 300);
        }

        function switchMode(mode) {
            currentMode = mode;
            
            const buttons = document.querySelectorAll('.mode-button');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                btn.style.backgroundColor = 'transparent';
            });
            
            const activeButton = event.currentTarget;
            activeButton.classList.add('active');
            
            if (currentVirtue) {
                activeButton.style.backgroundColor = 'var(--primary-color)';
                
                const practiceContainer = document.getElementById('practiceContainer');
                const studyContainer = document.getElementById('studyContainer');
                
                // Disable animations temporarily
                practiceContainer.style.transition = 'none';
                studyContainer.style.transition = 'none';
                
                if (mode === 'practice') {
                    studyContainer.style.display = 'none';
                    practiceContainer.style.display = 'block';
                } else {
                    practiceContainer.style.display = 'none';
                    studyContainer.style.display = 'block';
                }
                
                // Call showContent() to update the content based on the current mode
                showContent();
                
                // Re-enable animations after a short delay
                setTimeout(() => {
                    practiceContainer.style.transition = '';
                    studyContainer.style.transition = '';
                }, 50);
            }
        }

        function showContent() {
            document.getElementById('virtueGrid').style.display = 'none';
            const practiceContainer = document.getElementById('practiceContainer');
            const studyContainer = document.getElementById('studyContainer');
            
            practiceContainer.style.display = currentMode === 'practice' ? 'block' : 'none';
            studyContainer.style.display = currentMode === 'study' ? 'block' : 'none';
            
            if (currentMode === 'practice') {
                showPractice();
            } else {
                showStudyContent();
            }
        }

        function showPractice() {
            const practiceArray = virtuePractices[currentVirtue];
            document.getElementById('practiceText').textContent = practiceArray[currentPracticeIndex];
        }

        function nextPractice() {
            const practiceArray = virtuePractices[currentVirtue];
            const practiceText = document.getElementById('practiceText');
            const nextIndex = (currentPracticeIndex + 1) % practiceArray.length;
            const nextContent = practiceArray[nextIndex];
            
            animateContentTransition(practiceText, nextContent, true);
            currentPracticeIndex = nextIndex;
        }

        function previousPractice() {
            const practiceArray = virtuePractices[currentVirtue];
            const practiceText = document.getElementById('practiceText');
            const prevIndex = (currentPracticeIndex - 1 + practiceArray.length) % practiceArray.length;
            const prevContent = practiceArray[prevIndex];
            
            animateContentTransition(practiceText, prevContent, false);
            currentPracticeIndex = prevIndex;
        }

        function showVirtues() {
            const virtueGrid = document.getElementById('virtueGrid');
            const practiceContainer = document.getElementById('practiceContainer');
            const studyContainer = document.getElementById('studyContainer');
            const selectedVirtueContainer = document.getElementById('selectedVirtueContainer');
            const modeSelector = document.querySelector('.mode-selector');
            
            // Clear the grid first
            virtueGrid.innerHTML = '';
            
            // Reinitialize the virtue grid with buttons
            virtues.forEach((virtue, index) => {
                const button = document.createElement('button');
                button.className = 'virtue-button';
                button.style.backgroundColor = virtueColors[virtue];
                button.onclick = () => selectVirtue(virtue);
                button.textContent = virtue.charAt(0).toUpperCase() + virtue.slice(1);
                button.style.animationDelay = `${index * 0.1}s`;
                virtueGrid.appendChild(button);
            });
            
            // Animate current content out
            if (practiceContainer.style.display === 'block') {
                practiceContainer.classList.add('animate-out');
            }
            if (studyContainer.style.display === 'block') {
                studyContainer.classList.add('animate-out');
            }
            
            setTimeout(() => {
                // Hide all containers
                practiceContainer.style.display = 'none';
                studyContainer.style.display = 'none';
                selectedVirtueContainer.style.display = 'none';
                modeSelector.style.display = 'none';
                practiceContainer.classList.remove('animate-out');
                studyContainer.classList.remove('animate-out');
                
                // Show and animate in the virtue grid
                virtueGrid.style.display = 'grid';
                virtueGrid.classList.add('animate-in');
                
                setTimeout(() => {
                    virtueGrid.classList.remove('animate-in');
                }, 300);
            }, 300);
            
            // Reset the info button color
            document.getElementById('infoButton').style.backgroundColor = '#383838';
        }

        function showStudyContent() {
            document.getElementById('studyDefinition').textContent = virtueDefinitions[currentVirtue];
            showStory();
        }

        function showStory() {
            const stories = virtueStories[currentVirtue];
            document.getElementById('studyStory').textContent = stories[currentStoryIndex];
        }

        function nextStory() {
            const stories = virtueStories[currentVirtue];
            const storyText = document.getElementById('studyStory');
            const nextIndex = (currentStoryIndex + 1) % stories.length;
            const nextContent = stories[nextIndex];
            
            animateContentTransition(storyText, nextContent, true);
            currentStoryIndex = nextIndex;
        }

        function previousStory() {
            const stories = virtueStories[currentVirtue];
            const storyText = document.getElementById('studyStory');
            const prevIndex = (currentStoryIndex - 1 + stories.length) % stories.length;
            const prevContent = stories[prevIndex];
            
            animateContentTransition(storyText, prevContent, false);
            currentStoryIndex = prevIndex;
        }

        // Modal handling
        const modal = document.getElementById("infoModal");
        const closeButton = document.getElementsByClassName("close")[0];

        document.getElementById("infoButton").onclick = function() {
            modal.style.display = "block";
        }

        closeButton.onclick = function() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Load data when page loads
        loadVirtuesData();
    </script>
    <footer class="footer">
        <p>Created by <a href="https://tannerbraden.com">Tanner Braden</a> with the help of <a href="https://claude.ai">Claude</a></p>
    </footer>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>
</html>